<%- include('../partials/header') %>
<section id="show-page">
    <div class="collection-title"><%= idea.title %></div>
    <div class="idea-container">
        <div class="row align-items-start">
            <div class="col-7"><img src="<%= idea.image %>" width="500" height="600" class="rounded mx-auto d-block" alt="picture"></div>
            <!-- <div class="title"><%= idea.title %></div> -->
            <div class="col-5">
                <h5>Content:</h5>
                <div class="row-1" id="idea-content"><%= idea.content %></div>
                <!-- <button type="submit"><a href="/ideas/<%= idea._id %>/edit">Edit</a></button> -->
                <% if(user) { %>
                    <div class="row align-items-start">
                        <div class="col-5">
                            <form class="add-to-fav" action="/ideas/<%= idea._id %>" method="post">
                                <button type="submit" class="btn btn-dark btn-sm">Add to Favorites</button>
                            </form>
                        </div>
                        <div class="col-3">
                            <form class="edit-idea" action="/ideas/<%= idea._id %>/edit">
                                <button type="submit" class="btn btn-dark btn-sm">Edit Idea</button>
                            </form>
                        </div>
                        <div class="col-4">
                            <form class="delete-idea" action="/ideas/<%= idea._id %>?_method=DELETE" method="post">
                                <button type="submit" class="btn btn-dark btn-sm">Delete Idea</button>
                            </form>
                        </div>
                    </div>
                    <h5>Comments:</h5>
                    <br>
                    <% if (idea.comments.length) { %>
                        <% idea.comments.forEach(function(comment) { %>
                            <img class="avatar" alt="avatar" src="<%= comment.userAvatar %>" referrerpolicy="no-referrer" >
                            <div class="user-comment">
                                <%= comment.userName %>
                                <br><br>
                                <%= comment.content %>
                            </div>
                            <br>
                            <!-- <%= comment.createdAt.toLocaleDateString() %> -->
                            <% console.log('User ID:', user?._id, 'Comment User:', comment.user); %>
                            <% if (user?._id.equals(comment.user)) { %>
                                <form class="remove-comment" action="/comments/<%= comment._id %>?_method=DELETE" method="post">
                                    <button type="submit" class="btn btn-dark btn-sm">Remove</button>
                                </form>
                            <% } %>
                        <% }); %>
                    <% } %>
                    <br><br>
                    <form class="input-group" action="/ideas/<%= idea._id %>/comments" method="post">
                        <textarea type="text" name="content" class="form-control" aria-label="With textarea"></textarea>
                        <input class="input-group-text" type="submit" value="Add Comment">
                    </form>
                <% } %>
            </div>
        </div>
    </div>
</section>
<%- include('../partials/footer') %>